<?php
namespace lib\core;

class pinyinInit {

    private $pinyinArr = NULL;

    /**
     * 对外接口
     */
    public function pinyin($string, $utf8 = true) {
        $string = ($utf8 === true) ? iconv('utf-8', 'gbk//IGNORE', $string) : $string;
        if ($this->pinyinArr == NULL) {
            $this->pinyinArr = $this->pinyin_code();
        }
        $num = strlen($string);
        $pinyin = '';
        for ($i=0; $i < $num; $i++) {
            $temp = ord(substr($string, $i, 1));
            if ($temp > 160) {
                $temp2 = ord(substr($string, ++$i, 1));
                $temp  = $temp * 256 + $temp2 - 65536;
            }
            if ($temp > 0 && $temp < 160) {
                $pinyin .= chr($temp);
            } elseif ($temp < -20319 || $temp > -10247){
                $pinyin	.= '';
            } else {
                $total =sizeof($this->pinyinArr) - 1;
                for ($j = $total; $j >= 0; $j--) {
                    if ($this->pinyinArr[$j][1] <= $temp) {
                        break;
                    }
                }
                $pinyin .= $this->pinyinArr[$j][0];
            }
        }
        return ($utf8==true) ? iconv('gbk', 'utf-8', $pinyin) : $pinyin;
    }

    /**
     * 拼音代码库
     * @return array
     */
    protected function pinyin_code() {
        return array(
            array("A",-20319),
            array("Ai",-20317),
            array("An",-20304),
            array("Ang",-20295),
            array("Ao",-20292),
            array("Ba",-20283),
            array("Bai",-20265),
            array("Ban",-20257),
            array("Bang",-20242),
            array("Bao",-20230),
            array("Bei",-20051),
            array("Ben",-20036),
            array("Beng",-20032),
            array("Bi",-20026),
            array("Bian",-20002),
            array("Biao",-19990),
            array("Bie",-19986),
            array("Bin",-19982),
            array("Bing",-19976),
            array("Bo",-19805),
            array("Bu",-19784),
            array("Ca",-19775),
            array("Cai",-19774),
            array("Can",-19763),
            array("Cang",-19756),
            array("Cao",-19751),
            array("Ce",-19746),
            array("Ceng",-19741),
            array("Cha",-19739),
            array("Chai",-19728),
            array("Chan",-19725),
            array("Chang",-19715),
            array("Chao",-19540),
            array("Che",-19531),
            array("Chen",-19525),
            array("Cheng",-19515),
            array("Chi",-19500),
            array("Chong",-19484),
            array("Chou",-19479),
            array("Chu",-19467),
            array("Chuai",-19289),
            array("Chuan",-19288),
            array("Chuang",-19281),
            array("Chui",-19275),
            array("Chun",-19270),
            array("Chuo",-19263),
            array("Ci",-19261),
            array("Cong",-19249),
            array("Cou",-19243),
            array("Cu",-19242),
            array("Cuan",-19238),
            array("Cui",-19235),
            array("Cun",-19227),
            array("Cuo",-19224),
            array("Da",-19218),
            array("Dai",-19212),
            array("Dan",-19038),
            array("Dang",-19023),
            array("Dao",-19018),
            array("De",-19006),
            array("Deng",-19003),
            array("Di",-18996),
            array("Dian",-18977),
            array("Diao",-18961),
            array("Die",-18952),
            array("Ding",-18783),
            array("Diu",-18774),
            array("Dong",-18773),
            array("Dou",-18763),
            array("Du",-18756),
            array("Duan",-18741),
            array("Dui",-18735),
            array("Dun",-18731),
            array("Duo",-18722),
            array("E",-18710),
            array("En",-18697),
            array("Er",-18696),
            array("Fa",-18526),
            array("Fan",-18518),
            array("Fang",-18501),
            array("Fei",-18490),
            array("Fen",-18478),
            array("Feng",-18463),
            array("Fo",-18448),
            array("Fou",-18447),
            array("Fu",-18446),
            array("Ga",-18239),
            array("Gai",-18237),
            array("Gan",-18231),
            array("Gang",-18220),
            array("Gao",-18211),
            array("Ge",-18201),
            array("Gei",-18184),
            array("Gen",-18183),
            array("Geng",-18181),
            array("Gong",-18012),
            array("Gou",-17997),
            array("Gu",-17988),
            array("Gua",-17970),
            array("Guai",-17964),
            array("Guan",-17961),
            array("Guang",-17950),
            array("Gui",-17947),
            array("Gun",-17931),
            array("Guo",-17928),
            array("Ha",-17922),
            array("Hai",-17759),
            array("Han",-17752),
            array("Hang",-17733),
            array("Hao",-17730),
            array("He",-17721),
            array("Hei",-17703),
            array("Hen",-17701),
            array("Heng",-17697),
            array("Hong",-17692),
            array("Hou",-17683),
            array("Hu",-17676),
            array("Hua",-17496),
            array("Huai",-17487),
            array("Huan",-17482),
            array("Huang",-17468),
            array("Hui",-17454),
            array("Hun",-17433),
            array("Huo",-17427),
            array("Ji",-17417),
            array("Jia",-17202),
            array("Jian",-17185),
            array("Jiang",-16983),
            array("Jiao",-16970),
            array("Jie",-16942),
            array("Jin",-16915),
            array("Jing",-16733),
            array("Jiong",-16708),
            array("Jiu",-16706),
            array("Ju",-16689),
            array("Juan",-16664),
            array("Jue",-16657),
            array("Jun",-16647),
            array("Ka",-16474),
            array("Kai",-16470),
            array("Kan",-16465),
            array("Kang",-16459),
            array("Kao",-16452),
            array("Ke",-16448),
            array("Ken",-16433),
            array("Keng",-16429),
            array("Kong",-16427),
            array("Kou",-16423),
            array("Ku",-16419),
            array("Kua",-16412),
            array("Kuai",-16407),
            array("Kuan",-16403),
            array("Kuang",-16401),
            array("Kui",-16393),
            array("Kun",-16220),
            array("Kuo",-16216),
            array("La",-16212),
            array("Lai",-16205),
            array("Lan",-16202),
            array("Lang",-16187),
            array("Lao",-16180),
            array("Le",-16171),
            array("Lei",-16169),
            array("Leng",-16158),
            array("Li",-16155),
            array("Lia",-15959),
            array("Lian",-15958),
            array("Liang",-15944),
            array("Liao",-15933),
            array("Lie",-15920),
            array("Lin",-15915),
            array("Ling",-15903),
            array("Liu",-15889),
            array("Long",-15878),
            array("Lou",-15707),
            array("Lu",-15701),
            array("Lv",-15681),
            array("Luan",-15667),
            array("Lue",-15661),
            array("Lun",-15659),
            array("Luo",-15652),
            array("Ma",-15640),
            array("Mai",-15631),
            array("Man",-15625),
            array("Mang",-15454),
            array("Mao",-15448),
            array("Me",-15436),
            array("Mei",-15435),
            array("Men",-15419),
            array("Meng",-15416),
            array("Mi",-15408),
            array("Mian",-15394),
            array("Miao",-15385),
            array("Mie",-15377),
            array("Min",-15375),
            array("Ming",-15369),
            array("Miu",-15363),
            array("Mo",-15362),
            array("Mou",-15183),
            array("Mu",-15180),
            array("Na",-15165),
            array("Nai",-15158),
            array("Nan",-15153),
            array("Nang",-15150),
            array("Nao",-15149),
            array("Ne",-15144),
            array("Nei",-15143),
            array("Nen",-15141),
            array("Neng",-15140),
            array("Ni",-15139),
            array("Nian",-15128),
            array("Niang",-15121),
            array("Niao",-15119),
            array("Nie",-15117),
            array("Nin",-15110),
            array("Ning",-15109),
            array("Niu",-14941),
            array("Nong",-14937),
            array("Nu",-14933),
            array("Nv",-14930),
            array("Nuan",-14929),
            array("Nue",-14928),
            array("Nuo",-14926),
            array("O",-14922),
            array("Ou",-14921),
            array("Pa",-14914),
            array("Pai",-14908),
            array("Pan",-14902),
            array("Pang",-14894),
            array("Pao",-14889),
            array("Pei",-14882),
            array("Pen",-14873),
            array("Peng",-14871),
            array("Pi",-14857),
            array("Pian",-14678),
            array("Piao",-14674),
            array("Pie",-14670),
            array("Pin",-14668),
            array("Ping",-14663),
            array("Po",-14654),
            array("Pu",-14645),
            array("Qi",-14630),
            array("Qia",-14594),
            array("Qian",-14429),
            array("Qiang",-14407),
            array("Qiao",-14399),
            array("Qie",-14384),
            array("Qin",-14379),
            array("Qing",-14368),
            array("Qiong",-14355),
            array("Qiu",-14353),
            array("Qu",-14345),
            array("Quan",-14170),
            array("Que",-14159),
            array("Qun",-14151),
            array("Ran",-14149),
            array("Rang",-14145),
            array("Rao",-14140),
            array("Re",-14137),
            array("Ren",-14135),
            array("Reng",-14125),
            array("Ri",-14123),
            array("Rong",-14122),
            array("Rou",-14112),
            array("Ru",-14109),
            array("Ruan",-14099),
            array("Rui",-14097),
            array("Run",-14094),
            array("Ruo",-14092),
            array("Sa",-14090),
            array("Sai",-14087),
            array("San",-14083),
            array("Sang",-13917),
            array("Sao",-13914),
            array("Se",-13910),
            array("Sen",-13907),
            array("Seng",-13906),
            array("Sha",-13905),
            array("Shai",-13896),
            array("Shan",-13894),
            array("Shang",-13878),
            array("Shao",-13870),
            array("She",-13859),
            array("Shen",-13847),
            array("Sheng",-13831),
            array("Shi",-13658),
            array("Shou",-13611),
            array("Shu",-13601),
            array("Shua",-13406),
            array("Shuai",-13404),
            array("Shuan",-13400),
            array("Shuang",-13398),
            array("Shui",-13395),
            array("Shun",-13391),
            array("Shuo",-13387),
            array("Si",-13383),
            array("Song",-13367),
            array("Sou",-13359),
            array("Su",-13356),
            array("Suan",-13343),
            array("Sui",-13340),
            array("Sun",-13329),
            array("Uo",-13326),
            array("Ta",-13318),
            array("Tai",-13147),
            array("Tan",-13138),
            array("Tang",-13120),
            array("Tao",-13107),
            array("Te",-13096),
            array("Teng",-13095),
            array("Ti",-13091),
            array("Tian",-13076),
            array("Tiao",-13068),
            array("Tie",-13063),
            array("Ting",-13060),
            array("Tong",-12888),
            array("Tou",-12875),
            array("Tu",-12871),
            array("Tuan",-12860),
            array("Tui",-12858),
            array("Tun",-12852),
            array("Tuo",-12849),
            array("Wa",-12838),
            array("Wai",-12831),
            array("Wan",-12829),
            array("Wang",-12812),
            array("Wei",-12802),
            array("Wen",-12607),
            array("Weng",-12597),
            array("Wo",-12594),
            array("Wu",-12585),
            array("Xi",-12556),
            array("Xia",-12359),
            array("Xian",-12346),
            array("Xiang",-12320),
            array("Xiao",-12300),
            array("Xie",-12120),
            array("Xin",-12099),
            array("Xing",-12089),
            array("Xiong",-12074),
            array("Xiu",-12067),
            array("Xu",-12058),
            array("Xuan",-12039),
            array("Xue",-11867),
            array("Xun",-11861),
            array("Ya",-11847),
            array("Yan",-11831),
            array("Yang",-11798),
            array("Yao",-11781),
            array("Ye",-11604),
            array("Yi",-11589),
            array("Yin",-11536),
            array("Ying",-11358),
            array("Yo",-11340),
            array("Yo",-11340),
            array("Yong",-11339),
            array("You",-11324),
            array("Yu",-11303),
            array("Yuan",-11097),
            array("Yue",-11077),
            array("Yun",-11067),
            array("Za",-11055),
            array("Zai",-11052),
            array("Zan",-11045),
            array("Zang",-11041),
            array("Zao",-11038),
            array("Ze",-11024),
            array("Zei",-11020),
            array("Zen",-11019),
            array("Zeng",-11018),
            array("Zha",-11014),
            array("Zhai",-10838),
            array("Zhan",-10832),
            array("Zhang",-10815),
            array("Zhao",-10800),
            array("Zhe",-10790),
            array("Zhen",-10780),
            array("Zheng",-10764),
            array("Zhi",-10587),
            array("Zhong",-10544),
            array("Zhou",-10533),
            array("Zhu",-10519),
            array("Zhua",-10331),
            array("Zhuai",-10329),
            array("Zhuan",-10328),
            array("Zhuang",-10322),
            array("Zhui",-10315),
            array("Zhun",-10309),
            array("Zhuo",-10307),
            array("Zi",-10296),
            array("Zong",-10281),
            array("Zou",-10274),
            array("Zu",-10270),
            array("Zuan",-10262),
            array("Zui",-10260),
            array("Zun",-10256),
            array("Zuo",-10254),
        );
    }
}